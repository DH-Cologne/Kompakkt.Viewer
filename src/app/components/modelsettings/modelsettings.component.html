<mat-card class="titlecard">
  <mat-card-header>
    <mat-card-title>
      Model Settings
    </mat-card-title>
  </mat-card-header>
</mat-card>

<div *ngIf="activeModel != null" id="editor-modelsettings">

  <div *ngIf="initialSettingsMode">

    <mat-vertical-stepper [linear]=true #stepper>

      <mat-step>
        <ng-template matStepLabel>Set Mesh Settings</ng-template>

        <h5>Information & Helpers
          <button mat-icon-button (click)="toggleHelpers()"
                  matTooltip="Toggle" matTooltipPosition="above"
                  type="button">
            <mat-icon *ngIf="!showHelpers" aria-label="Toggle">keyboard_arrow_down</mat-icon>
            <mat-icon *ngIf="showHelpers" aria-label="Toggle">keyboard_arrow_up</mat-icon>
          </button>
        </h5>


        <div *ngIf="showHelpers">

          <button class="fullwidth-button"
                  mat-raised-button
                  (click)="resetHelpers()">Reset Helper
          </button>

          <h5>Number of meshes: {{modelSettingsService.actualModelMeshes.length}}</h5>

          <mat-checkbox [checked]="modelSettingsService.showBoundingBoxModel"
                        (change)="modelSettingsService.handleChangeBoundingBoxModel()"><h5>Bounding Box Model</h5>
          </mat-checkbox>

          <mat-checkbox [checked]="modelSettingsService.showBoundingBoxMeshes"
                        (change)="modelSettingsService.handleChangeBoundingBoxMeshes()"><h5>Bounding Box Meshes</h5>
          </mat-checkbox>

          <h5> Background
            <button mat-icon-button (click)="toggleHelperBackground()"
                    matTooltip="Toggle" matTooltipPosition="above"
                    type="button">
              <mat-icon *ngIf="!showHelperBackground" aria-label="Toggle">keyboard_arrow_down</mat-icon>
              <mat-icon *ngIf="showHelperBackground" aria-label="Toggle">keyboard_arrow_up</mat-icon>
            </button>
          </h5>
          <div *ngIf="showHelperBackground">
            <color-chrome (onChange)="handleChangeColor($event)"></color-chrome>
          </div>

          <mat-checkbox [checked]="modelSettingsService.showWorldAxis"
                        (change)="modelSettingsService.handleChangeWorldAxis()"><h5>World Axis</h5>
          </mat-checkbox>
          <div *ngIf="modelSettingsService.showWorldAxis">
            <h6>Size</h6>
            <mat-slider min="0.1" max="8" step="0.1" value={{modelSettingsService.scalingFactorWorldAxis}}
                        #matslider
                        (input)="modelSettingsService.setScalingFactorWorldAxis($event)"></mat-slider>
          </div>
          <br>

          <mat-checkbox [checked]="modelSettingsService.showLocalAxis"
                        (change)="modelSettingsService.handleChangeLocalAxis()"><h5>Local Axis</h5>
          </mat-checkbox>
          <div *ngIf="modelSettingsService.showLocalAxis">
            <h6>Size</h6>
            <mat-slider min="0.1" max="8" step="0.1" value={{modelSettingsService.scalingFactorLocalAxis}}
                        #matslider
                        (input)="modelSettingsService.setScalingFactorLocalAxis($event)"></mat-slider>
          </div>
          <br>

          <mat-checkbox [checked]="modelSettingsService.showGround"
                        (change)="modelSettingsService.handleChangeGround()"><h5>Ground</h5>
          </mat-checkbox>
          <div *ngIf="modelSettingsService.showGround">
            <h6>Size</h6>
            <mat-slider min="0" max="10" step="1" value={{modelSettingsService.scalingFactorGround}} #matslider
                        (input)="modelSettingsService.setScalingFactorGround($event)"></mat-slider>
            <h6>Color</h6>
            <color-chrome (onChange)="modelSettingsService.handleChangeColorGround($event)"></color-chrome>
          </div>

          <button class="fullwidth-button"
                  mat-raised-button
                  (click)="resetHelpers()">Reset Helper
          </button>

        </div>


        <h5>Set Settings</h5>

        <h5 style="padding-left:1em"> Scale
          <button mat-icon-button (click)="toggleScaling()"
                  matTooltip="Toggle" matTooltipPosition="above"
                  type="button">
            <mat-icon *ngIf="!showScaling" aria-label="Toggle">keyboard_arrow_down</mat-icon>
            <mat-icon *ngIf="showScaling" aria-label="Toggle">keyboard_arrow_up</mat-icon>
          </button>
        </h5>


        <div *ngIf="showScaling">
          <button class="fullwidth-button"
                  mat-raised-button
                  (click)="resetMeshSize()">Reset Size
          </button>
          <h6>Height:
            <mat-form-field>
              <input matInput min="0" max={{modelSettingsService.height*5}}
                     [(ngModel)]="modelSettingsService.height" type="number" step="0.5"
                     (input)="modelSettingsService.handleChangeHeight()">
            </mat-form-field>
            cm
          </h6>

          <h6>Width:
            <mat-form-field>
              <input matInput min="0" max={{modelSettingsService.width*5}}
                     [(ngModel)]="modelSettingsService.width" type="number" step="0.5"
                     (input)="modelSettingsService.handleChangeWidth()">
            </mat-form-field>
            cm
          </h6>

          <h6>Depth:
            <mat-form-field>
              <input matInput min="0" max={{modelSettingsService.depth*5}}
                     [(ngModel)]="modelSettingsService.depth" type="number" step="0.5"
                     (input)="modelSettingsService.handleChangeDepth()">
            </mat-form-field>
            cm
          </h6>

          <h6>Scale factor: {{modelSettingsService.scalingFactor}}</h6>
          <mat-slider min="0.0" max="5" step="0.05" value={{modelSettingsService.scalingFactor}} #matslider
                      (input)="modelSettingsService.setScalingFactor($event)"></mat-slider>

        </div>
        <h5 style="padding-left:1em"> Orientation
          <button mat-icon-button (click)="toggleOrientation()"
                  matTooltip="Toggle" matTooltipPosition="above"
                  type="button">
            <mat-icon *ngIf="!showOrientation" aria-label="Toggle">keyboard_arrow_down</mat-icon>
            <mat-icon *ngIf="showOrientation" aria-label="Toggle">keyboard_arrow_up</mat-icon>
          </button>
        </h5>
        <div *ngIf="showOrientation">
          <button class="fullwidth-button"
                  mat-raised-button
                  (click)="resetMeshRotation()">Reset Rotation
          </button>
          <h5>X</h5>
          <button mat-icon-button (click)="modelSettingsService.handleChangeRotationX(-90)"
                  matTooltip="Rotate -90°" matTooltipPosition="above"
                  type="button">
            <mat-icon aria-label="Rotate -90°">undo</mat-icon>
          </button>
          <mat-form-field>
            <input matInput min="0" max="360" [(ngModel)]="modelSettingsService.rotationX" type="number" step="1"
                   (input)="modelSettingsService.handleChangeRotationX(0)">
          </mat-form-field>
          °
          <button mat-icon-button (click)="modelSettingsService.handleChangeRotationX(+90)"
                  matTooltip="Rotate 90°" matTooltipPosition="above"
                  type="button">
            <mat-icon aria-label="Rotate 90°">redo</mat-icon>
          </button>

          <h5>Y</h5>
          <button mat-icon-button (click)="modelSettingsService.handleChangeRotationY(-90)"
                  matTooltip="Rotate -90°" matTooltipPosition="above"
                  type="button">
            <mat-icon aria-label="Rotate -90°">undo</mat-icon>
          </button>
          <mat-form-field>
            <input matInput min="0" max="360" [(ngModel)]="modelSettingsService.rotationY" type="number" step="1"
                   (input)="modelSettingsService.handleChangeRotationY(0)">
          </mat-form-field>
          °
          <button mat-icon-button (click)="modelSettingsService.handleChangeRotationY(+90)"
                  matTooltip="Rotate 90°" matTooltipPosition="above"
                  type="button">
            <mat-icon aria-label="Rotate 90°">redo</mat-icon>
          </button>

          <h5>Z</h5>
          <button mat-icon-button (click)="modelSettingsService.handleChangeRotationZ(-90)"
                  matTooltip="Rotate -90°" matTooltipPosition="above"
                  type="button">
            <mat-icon aria-label="Rotate -90">undo</mat-icon>
          </button>
          <mat-form-field>
            <input matInput min="0" max="360" [(ngModel)]="modelSettingsService.rotationZ" type="number" step="1"
                   (input)="modelSettingsService.handleChangeRotationZ(0)">
          </mat-form-field>
          °
          <button mat-icon-button (click)="modelSettingsService.handleChangeRotationZ(+90)"
                  matTooltip="Rotate 90°" matTooltipPosition="above"
                  type="button">
            <mat-icon aria-label="Rotate 90°">redo</mat-icon>
          </button>
        </div>

        <div>
          <button mat-button (click)="showNextAlertFirstStep()">Next</button>
        </div>

      </mat-step>


      <mat-step>
        <ng-template matStepLabel>Set Initial Settings</ng-template>

        <h5>Background
          <button mat-icon-button (click)="toggleBackground()"
                  matTooltip="Toggle" matTooltipPosition="above"
                  type="button">
            <mat-icon *ngIf="!showBackground" aria-label="Toggle">keyboard_arrow_down</mat-icon>
            <mat-icon *ngIf="showBackground" aria-label="Toggle">keyboard_arrow_up</mat-icon>
          </button>
        </h5>
        <div *ngIf="showBackground">
          <color-chrome (onChange)="handleChangeColor($event)"></color-chrome>
          <br>
          <mat-slide-toggle (change)="handleChangeEffekt()">Gradient-Brightness Effect</mat-slide-toggle>
        </div>

        <h5>Lights
          <button mat-icon-button (click)="toggleLights()"
                  matTooltip="Toggle" matTooltipPosition="above"
                  type="button">
            <mat-icon *ngIf="!showLights" aria-label="Toggle">keyboard_arrow_down</mat-icon>
            <mat-icon *ngIf="showLights" aria-label="Toggle">keyboard_arrow_up</mat-icon>
          </button>
        </h5>
        <div *ngIf="showLights">
          <h4>Brightness</h4>
          <p>Ambient environment lights</p>
          <h5>Fabulous (up towards the sky)</h5>
          <mat-slider min="0" max="1" step="0.1" value={{ambientlightUpintensity}} #matslider
                      (input)="setAmbientlightIntensityUp($event)"></mat-slider>
          <h5>Sunny (down towards the ground)</h5>
          <mat-slider min="0" max="1" step="0.1" value={{ambientlightDownintensity}} #matslider
                      (input)="setAmbientlightIntensityDown($event)"></mat-slider>
          <br>
          <p>Pointlight</p>
          <mat-slider min="0" max="1" step="0.1" value={{babylonService.pointlightIntensity}} #matslider
                      (input)="setPointlightIntensity($event)"></mat-slider>
          <h5>Pointlight Dimensions: X Y Z</h5>
          <mat-slider min="-10" max="10" step="1" value={{babylonService.pointlightPosX}} #matslider
                      (input)="pointlightPosX($event)" vertical></mat-slider>
          <mat-slider min="-10" max="10" step="1" value={{babylonService.pointlightPosY}} #matslider
                      (input)="pointlightPosY($event)" vertical></mat-slider>
          <mat-slider min="-10" max="10" step="1" value={{babylonService.pointlightPosZ}} #matslider
                      (input)="pointlightPosZ($event)" vertical></mat-slider>
        </div>

        <h5> Preview & Initial Perspective
          <button mat-icon-button (click)="togglePreview()"
                  matTooltip="Toggle" matTooltipPosition="above"
                  type="button">
            <mat-icon *ngIf="!showPreview" aria-label="Toggle">keyboard_arrow_down</mat-icon>
            <mat-icon *ngIf="showPreview" aria-label="Toggle">keyboard_arrow_up</mat-icon>
          </button>
        </h5>
        <div *ngIf="showPreview">
          Please select a nice and fitting camera perspective before you go on to the next step.
          By clicking on the next button the actual view will be set as initial perspective.
          And I will automatically produce a preview - smile!
        </div>

        <div>
          <button mat-button (click)="nextSecondStep()">Next</button>
        </div>

      </mat-step>


      <mat-step>
        <ng-template matStepLabel>Done</ng-template>
        <img class="previewimage" src={{preview}}>
        You set all settings and I celebrate it with this preview.
        <br> Please save them if you are done. Afterwards you may add annotations.
        <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button (click)="saveLastStep()">Save</button>
        </div>
      </mat-step>

    </mat-vertical-stepper>
  </div>


  <div *ngIf="!initialSettingsMode">

    <mat-card>
      <mat-card-content>
        <button class="fullwidth-button"
                mat-raised-button
                (click)="backToDefault()">Back to Default
        </button>
        <button class="fullwidth-button"
                mat-raised-button
                *ngIf="!isDefault && isModelOwner && isSingleModel"
                (click)="saveActualSettings()">Save as default
        </button>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title>
          Background
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <color-chrome (onChange)="handleChangeColor($event)"></color-chrome>
        <br>
        <mat-slide-toggle (change)="handleChangeEffekt()">Gradient-Brightness Effect</mat-slide-toggle>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title>
          Lights
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <h4>Brightness</h4>
        <p>Ambient environment lights</p>
        <h5>Fabulous (up towards the sky)</h5>
        <mat-slider min="0" max="1" step="0.1" value={{ambientlightUpintensity}} #matslider
                    (input)="setAmbientlightIntensityUp($event)"></mat-slider>
        <h5>Sunny (down towards the ground)</h5>
        <mat-slider min="0" max="1" step="0.1" value={{ambientlightDownintensity}} #matslider
                    (input)="setAmbientlightIntensityDown($event)"></mat-slider>
        <br>
        <p>Pointlight</p>
        <mat-slider min="0" max="1" step="0.1" value={{babylonService.pointlightIntensity}} #matslider
                    (input)="setPointlightIntensity($event)"></mat-slider>
        <h5>Pointlight Dimensions: X Y Z</h5>
        <mat-slider min="-10" max="10" step="1" value={{babylonService.pointlightPosX}} #matslider
                    (input)="pointlightPosX($event)" vertical></mat-slider>
        <mat-slider min="-10" max="10" step="1" value={{babylonService.pointlightPosY}} #matslider
                    (input)="pointlightPosY($event)" vertical></mat-slider>
        <mat-slider min="-10" max="10" step="1" value={{babylonService.pointlightPosZ}} #matslider
                    (input)="pointlightPosZ($event)" vertical></mat-slider>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title>
          Preview & Initial Perspective
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        Click on this image to set actual view as initial perspective.
        <img class="previewimage" src={{preview}} (click)="setInitialView()">
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-content>
        <button class="fullwidth-button"
                mat-raised-button
                (click)="backToDefault()">Back to Default
        </button>
        <button class="fullwidth-button"
                mat-raised-button
                *ngIf="!isDefault && isModelOwner && isSingleModel"
                (click)="saveActualSettings()">Save as default
        </button>
      </mat-card-content>
    </mat-card>

  </div>
</div>
